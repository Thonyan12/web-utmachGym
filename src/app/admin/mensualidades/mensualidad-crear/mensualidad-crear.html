<!-- ...existing code... -->
<div class="d-flex" style="min-height: 100vh;">
  <!-- Sidebar reutilizable para Mensualidades -->
  <app-mensualidad-sidebar></app-mensualidad-sidebar>

  <!-- Contenido principal del formulario -->
  <div class="flex-grow-1 p-4 bg-light">
    <div class="container mt-4">
      <h3 class="fw-bold m-0 mb-4" style="color: #14213d;">
        <i class="bi bi-calendar-check me-2"></i> Registrar Mensualidad
      </h3>

      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <form (ngSubmit)="guardar(form)" #form="ngForm" novalidate>
            <!-- Buscar por Cédula -->
            <div class="mb-3">
              <label for="cedula" class="form-label">Cédula del Miembro</label>
              <div class="input-group">
                <input type="text" class="form-control" id="cedula" [(ngModel)]="cedula" name="cedula" required #cedulaCtrl="ngModel" placeholder="Ingrese cédula">
                <button type="button" class="btn btn-outline-secondary" (click)="buscarMiembroPorCedula()" [disabled]="!cedula || buscandoMiembro">
                  {{ buscandoMiembro ? 'Buscando...' : 'Buscar' }}
                </button>
              </div>
              <div class="text-danger mt-1" *ngIf="cedulaCtrl.invalid && (cedulaCtrl.dirty || cedulaCtrl.touched)">
                <span *ngIf="cedulaCtrl.errors?.['required']">La cédula es obligatoria.</span>
              </div>
              <div class="text-danger mt-1" *ngIf="errorBusqueda">{{ errorBusqueda }}</div>
            </div>

            <!-- Nombre / Apellido autocompletados (readonly) -->
            <div class="row">
              <div class="mb-3 col-md-6">
                <label class="form-label">Nombre</label>
                <input type="text" class="form-control" [value]="nombreMiembro" readonly>
              </div>
              <div class="mb-3 col-md-6">
                <label class="form-label">Apellido</label>
                <input type="text" class="form-control" [value]="apellidoMiembro" readonly>
              </div>
            </div>

            <!-- Campo Fecha Inicio -->
            <div class="mb-3">
              <label for="fechaInicio" class="form-label">Fecha Inicio</label>
              <input type="date" class="form-control rounded-md" id="fechaInicio" [(ngModel)]="mensualidad.fecha_inicio" name="fecha_inicio" required (change)="calcularFechaFin()" #fechaInicio="ngModel">
              <div class="text-danger mt-1" *ngIf="fechaInicio.invalid && (fechaInicio.dirty || fechaInicio.touched)">
                <span *ngIf="fechaInicio.errors?.['required']">La fecha de inicio es obligatoria.</span>
              </div>
            </div>

            <!-- Fecha Fin calculada -->
            <div class="mb-3">
              <label for="fechaFin" class="form-label">Fecha Fin (automática +30 días)</label>
              <input type="date" class="form-control" id="fechaFin" [value]="mensualidad.fecha_fin" readonly>
            </div>

            <!-- Campo Monto -->
            <div class="mb-3">
              <label for="monto" class="form-label">Monto</label>
              <input type="number" class="form-control rounded-md" id="monto" [(ngModel)]="mensualidad.monto" name="monto" required step="0.01" min="0.01" #monto="ngModel">
              <div class="text-danger mt-1" *ngIf="monto.invalid && (monto.dirty || monto.touched)">
                <span *ngIf="monto.errors?.['required']">El monto es obligatorio.</span>
                <span *ngIf="monto.errors?.['min']">Debe ser mayor a 0.</span>
              </div>
            </div>

            <!-- Campo Estado Mensualidad -->
            <div class="mb-3">
              <label for="estadoMensualidad" class="form-label">Estado Mensualidad</label>
              <select class="form-select rounded-md" id="estadoMensualidad" [(ngModel)]="mensualidad.estado_mensualidad" name="estado_mensualidad" required #estadoMensualidad="ngModel">
                <option value="" disabled selected>Seleccione un estado</option>
                <option value="Pagada">Pagada</option>
                <option value="Pendiente">Pendiente</option>
              </select>
              <div class="text-danger mt-1" *ngIf="estadoMensualidad.invalid && (estadoMensualidad.dirty || estadoMensualidad.touched)">
                <span *ngIf="estadoMensualidad.errors?.['required']">El estado de la mensualidad es obligatorio.</span>
              </div>
            </div>

            <!-- Mensaje de error general del formulario -->
            <div *ngIf="form.invalid && form.submitted" class="alert alert-danger rounded-md">
              Por favor, corrige los errores antes de guardar la mensualidad.
            </div>

            <!-- Botones de acción -->
            <div class="d-flex justify-content-end gap-2 mt-4">
              <button type="button" class="btn btn-secondary rounded-md" routerLink="/admin/mensualidades">
                <i class="bi bi-arrow-left me-1"></i> Volver
              </button>
              <button type="submit" class="btn btn-primary rounded-md" [disabled]="form.invalid || !miembroEncontrado" style="background-color: #14213d; border-color: #14213d;">
                <i class="bi bi-save me-1"></i> Guardar Mensualidad
              </button>
            </div>

            <!-- Mensaje de confirmación/error después de guardar -->
            <div class="mt-3 text-center" *ngIf="mensaje">
              <div [class]="'alert rounded-md ' + (mensaje.includes('éxito') ? 'alert-success' : 'alert-danger')">
                {{ mensaje }}
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ...existing code... -->